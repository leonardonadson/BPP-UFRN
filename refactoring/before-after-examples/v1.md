# Atualização #1: Centralização da Lógica de Negócio
O exemplo mais significativo desta atualização foi a refatoração do endpoint complete_task, que moveu toda a lógica de negócio do router para a camada de serviço, simplificando o controlador e centralizando a transação com a base de dados.

**ANTES (em routers/tasks.py):**

    @router.patch("/{task_id}/complete", response_model=TaskResponse)
    def complete_task(
        task_id: int,
        current_user: User = Depends(get_current_user),
        db: Session = Depends(get_db)
    ):
        # Lógica de busca e validação DUPLICADA
        task = db.query(TaskModel).filter(
            TaskModel.id == task_id,
            TaskModel.owner_id == current_user.id
        ).first()

        if not task:
            raise HTTPException(...)

        if task.is_completed:
            raise HTTPException(...)

        # LÓGICA DE NEGÓCIO no router
        task.is_completed = True
        points_earned = award_points_for_task(current_user, task, db)
        streak_updated = update_user_streak(current_user, db)
        badges_earned = check_and_award_badges(current_user, db)

        db.commit() # Commit final no router

        return {
            "task": task,
            "points_earned": points_earned,
            "streak_updated": streak_updated,
            "badges_earned": badges_earned
        }

**DEPOIS (em routers/tasks.py):**

    @router.patch("/{task_id}/complete", response_model=TaskResponse)
    def complete_task(
        task: TaskModel = Depends(get_task_for_user_dependency), # Duplicação removida
        current_user: User = Depends(get_current_user),
        db: Session = Depends(get_db)
    ):
        if task.is_completed:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Tarefa já foi concluída"
            )

        # Lógica de negócio DELEGADA para a camada de serviço
        completion_data = process_task_completion(current_user, task, db)

        return completion_data
